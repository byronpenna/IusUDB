@using IUSLibs.RRHH.Entidades
@using IUSLibs.RRHH.Entidades.Laboral
@using IUSLibs.SEC.Entidades
@section estilosPersonalizados{
    <!-- plugins -->
        <!--Data table-->
            <link rel="stylesheet" href="~/Content/third-party/datatable/css/jquery.dataTables.min.css" />
        <!-- chosen -->
            <link rel="stylesheet" href="~/Content/third-party/chosen/css/chosen.min.css" />
    <!-- Propios -->
        <link rel="stylesheet" href="~/Content/themes/iusback_theme/views/GestionPersonas/laboral/style.css" />
        <link rel="stylesheet" href="~/Content/themes/iusback_theme/views/GestionPersonas/laboral/media.css" />
}
@section scriptsPersonalizados{
    <!-- plugins -->
        <!-- Data table -->
            <script src="~/Content/third-party/datatable/js/jquery.dataTables.js"></script>    
        <!-- chosen -->
            <script src="~/Content/third-party/chosen/js/chosen.jquery.min.js"></script>
    <!-- propios -->
        <script src="~/Scripts/Views/GestionPersonas/Laboral/script.js"></script>
        <script src="~/Scripts/Views/GestionPersonas/Laboral/functions.js"></script>
}
@section arbol{
    <div class="col-lg-3 text-center cuadritoArbol">
        <a href="@Url.Action("Index", "GestionPersonas")">
            <div class="col-lg-8">
                Personas
            </div>
            <div class="col-lg-4 divChevron">
                <i class="fa fa-chevron-right navChevron"></i>
            </div>
        </a>
    </div>
    <div class="col-lg-3 text-center cuadritoArbol">
        <a href="@ViewBag.currentUrl">
            <div class="col-lg-8">
                Laboral
            </div>
            <div class="col-lg-4 divChevron">
                <i class="fa fa-chevron-right navChevron"></i>
            </div>
        </a>
    </div>
}
@{
    List<Empresa> empresas = null; List<CargoEmpresa> cargos = null;
    List<LaboralPersona> laboralesPersonas = null; Persona persona = null;
    List<Persona> personas = null;InformacionPersona infoPersona = null;
    string strFoto = Url.Content(@ViewBag.IMG_GENERALES + "profle.png");
    try{
        Dictionary<object,object> 
            iniciales           = (Dictionary<object,object>)ViewBag.iniciales;
            persona             = (Persona)iniciales["persona"];
            empresas            = (List<Empresa>)iniciales["empresas"];
            cargos              = (List<CargoEmpresa>)iniciales["cargos"];
            laboralesPersonas   = (List<LaboralPersona>)iniciales["laboralesPersonas"];
            personas            = (List<Persona>)iniciales["personas"];
            infoPersona         = (InformacionPersona)iniciales["infoPersona"];
            if (infoPersona != null && infoPersona._tieneFoto)
            {
                strFoto = Url.Content(infoPersona._fotoRuta);
            }
    }catch(Exception){
        
    }
}
@section tabs{
    <ul>
        <a href="@Url.Action("Extras", "GestionPersonas", new { id = ViewBag.idPersona })">
            <li>
                Informacion
            </li>
        </a>
        <a href="@Url.Action("Index", "FormacionPersonas", new {id=ViewBag.idPersona })">
            <li>
                Formacion
            </li>
        </a>
        <li class="btnTab tabActive">
            Laboral
        </li>
    </ul>

}
<div class="row marginNull rowDataPersona">
    <div class="row marginNull divTituloNombre">
        <div class="normalMode">
            <h2 class="titlePersona">@persona.nombreCompleto </h2>
        </div>
        <div class='editMode hidden'>
            <div class="col-lg-offset-4 col-lg-3 ">
                <select class="cbPersonas form-control">
                    @if (personas != null && personas.Count > 0)
                    {
                        string selected = "";
                        foreach (Persona personaI in personas)
                        {
                            if (personaI._idPersona == persona._idPersona)
                            {
                                selected = "selected";
                            }
                            else
                            {
                                selected = "";
                            }
                            <option value="@personaI._idPersona" @selected>@personaI._nombres</option>
                        }

                    }
                </select>
            </div>
            <div class="col-lg-1">
                <i class="fa fa-times icoVolverAnombre"></i>
            </div>
        </div>
    </div>
    <img class="imgPersona" src="@strFoto" />
</div>
<input type="hidden" class="txtHdIdPersona" value="@ViewBag.idPersona" />
<div class="marginNull row divMensajesGenerales">
    xxx
</div>
<table class="table tablaLaboral">
    <thead>
        <tr>
            <th class="hidden"></th>
            <th>Empresa</th>
            <th class="txtDate">Inicio</th>
            <th class="txtDate">Fin</th>
            <th>Observaciones</th>
            <th>Cargo desempeñado</th>
            <th>Acciones</th>
        </tr>
        <tr>
            <th class="hidden"></th>
            <th>
                <div class="row marginNull divControl">
                    <select class="form-control cbEmpresa" name="cbEmpresa">
                        @if (empresas != null && empresas.Count > 0)
                        {
                            foreach (Empresa empresa in empresas)
                            {
                                <option value="@empresa._idEmpresa">@empresa._nombre</option>
                            }
                        }
                    </select>
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </div>
            </th>
            <th>
                <div class="row marginNull divControl">
                    <input type="number" class="form-control txtInicio soloNumerosInt" name="txtInicio" min="1970" max="2100" />
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </div>
            </th>
            <th>
                <div class="row marginNull divControl">
                    <input type="number" class="form-control txtFin soloNumerosInt" name="txtFin" min="1970" max="2100" />
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </div>
            </th>
            <th>
                <div class="divControl row marginNull">
                    <textarea class="form-control txtAreaObservacion" name="txtAreaObservacion"></textarea>
                    <div class="row marginNull divResultado hidden">

                    </div>
                </div>
            </th>
            <th>
                <div class="divControl row marginNull">
                    <select class="form-control cbCargo" name="cbCargo">
                        @if (cargos != null && cargos.Count > 0)
                        {
                            foreach (CargoEmpresa cargo in cargos)
                            {
                                <option value="@cargo._idCargoEmpresa">@cargo._cargo</option>
                            }
                        }
                    </select>
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </div>
            </th>
            <th>
                <button class="btn btnAgregarLaboralPersona">Agregar</button>
            </th>
        </tr>
    </thead>
    <tbody class="tbodyLaboralPersona">
        @if (laboralesPersonas != null && laboralesPersonas.Count > 0)
        {
            foreach (LaboralPersona laboralPersona in laboralesPersonas)
            {
                <tr>
                    <td class="hidden">
                        <input type="hidden" value="@laboralPersona._idLaboralPersona" class="txtHdIdLaboralPersona" name="txtHdIdLaboralPersona" />
                        <input type="hidden" value="@laboralPersona._empresa._idEmpresa" class="txtHdIdEmpresa" name="txtHdIdEmpresa">
                        <input type="hidden" value="@laboralPersona._cargo._idCargoEmpresa" class="txtHdIdCargoEmpresa" name="txtHdIdCargoEmpresa">
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <select class="form-control cbEmpresa" name="cbEmpresa">

                            </select>
                        </div>
                        <div class="normalMode tdNombreEmpresa">
                            @laboralPersona._empresa._nombre
                        </div>
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <input type="number" class="form-control txtInicio" name="txtInicio" />
                        </div>
                        <div class="normalMode tdFechaInicio">
                            @laboralPersona._inicio
                        </div>
                        
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <input type="number" class="form-control txtFin" name="txtFin" />
                        </div>
                        <div class="normalMode tdFechaFin">
                            @laboralPersona._fin
                        </div>
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <textarea class="form-control txtAreaObservacion" name="txtAreaObservacion"></textarea>
                        </div>
                        <div class="normalMode tdObservaciones">
                            @laboralPersona._observaciones
                        </div>
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <select class="form-control cbCargo" name="cbCargo">

                            </select>
                        </div>
                        <div class="normalMode tdCargo">
                            @laboralPersona._cargo._cargo
                        </div>
                    </td>
                    <td>
                        <div class="editMode hidden">
                            <button class="btn btnActualizarLaboralPersona">Actualizar</button>
                            <button class="btn btnCancelarUni">Cancelar</button>
                        </div>
                        <div class="normalMode tdBotones">
                            <button class="btn btnEditarLaboralPersona btn-sm">Editar</button>
                            <button class="btn btnActividad btn-sm">Actividades realizadas</button>
                            <button class="btn btnEliminarLaboralPersona btn-sm">Eliminar</button>
                        </div>
                    </td>
                </tr>
                
            }
            
        }else{
            <tr class="trNoRegistro">
                @for (int i = 0; i < 6; i++)
                {
                    <td class="hidden"></td>    
                }
                <td colspan="7" class="text-center ">
                    No hay registro laboral para esta persona 
                </td>
            </tr>
        }
    </tbody>
</table>