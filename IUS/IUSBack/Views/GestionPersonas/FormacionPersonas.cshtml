@using IUSLibs.RRHH.Entidades
@using IUSLibs.RRHH.Entidades.Formacion
@using IUSLibs.SEC.Entidades
@using IUSLibs.FrontUI.Entidades
@section estilosPersonalizados{
    <!-- plugins -->
        <!-- chosen -->
            <link rel="stylesheet" href="~/Content/third-party/chosen/css/chosen.min.css" />
    <!-- Propios -->
        <link rel="stylesheet" href="~/Content/themes/iusback_theme/views/GestionPersonas/FormacionPersonas/style.css" />
        <link rel="stylesheet" href="~/Content/themes/iusback_theme/views/GestionPersonas/FormacionPersonas/media.css" />
}
@section scriptsPersonalizados{
    <!-- Plugins -->
        <!-- chosen -->
            <script src="~/Content/third-party/chosen/js/chosen.jquery.min.js"></script>
    <!-- propios -->
        <script src="~/Scripts/Views/GestionPersonas/FormacionPersonas/script.js"></script>
        <script src="~/Scripts/Views/GestionPersonas/FormacionPersonas/functions.js"></script>
}
@{
    List<EstadoCarrera> estadosCarrera=null;Persona persona= null;
    List<Pais> paises = null; List<InstitucionEducativa> institucionesEducativas = null;
    List<NivelTitulo> nivelesTitulo = null; List<Carrera> carreras = null;
    List<FormacionPersona> formacionesPersonas= null;
    List<AreaCarrera> areasCarreras = null;
    string strFoto = Url.Content("~/Content/themes/iusback_theme/img/general/profle.png");
    InformacionPersona informacion = null;
    try{
        Dictionary<object, object> info = (Dictionary<object,object>)ViewBag.infoIni;
        estadosCarrera                  = (List<EstadoCarrera>)info["estadosCarrera"];
        persona                         = (Persona)info["persona"];
        paises                          = (List<Pais>)info["paises"];
        institucionesEducativas         = (List<InstitucionEducativa>)info["instituciones"];
        nivelesTitulo                   = (List<NivelTitulo>)info["nivelesTitulo"];
        carreras                        = (List<Carrera>)info["carreras"];
        formacionesPersonas             = (List<FormacionPersona>)info["formacionesPersonas"];
        informacion                     = (InformacionPersona)info["informacionPersona"];
        areasCarreras                   = (List<AreaCarrera>)info["areasCarreras"];
        if (informacion != null && informacion._tieneFoto)
        {
            strFoto = Url.Content(informacion._fotoRuta);
        }
    }catch(Exception){
        
    }
}
@section tabs{
    <ul>
        <a href="@Url.Action("Extras", "GestionPersonas", new { id = persona._idPersona })">
            <li>
                Informacion
            </li>
        </a>
        <li class="btnTab tabActive">
            Formacion
        </li>
        <a href="@Url.Action("Index", "GestionLaboral", new {id=persona._idPersona })">
            <li>
                Laboral
            </li>
        </a>
    </ul>
    
}
<input type="hidden" class="txtHdIdPersona" value="@persona._idPersona" />
<div class="row marginNull divControles">
    <div class="row marginNull rowDataPersona">
        <h2 class="titlePersona">@persona.nombreCompleto</h2>
        <img class="imgPersona" src="@strFoto" />
    </div>
    
    <div class="col-lg-offset-5 col-lg-2 text-center">
        <label>Vistas</label>
        <div class="herramientaVistaSection accionesDiv form-control inputBackModal">
            <a href="#" id="divInformacionCarreras" class="icoVista activeVista" title="titulos persona">
                <i class="fa fa-user"></i>
            </a>
            <a href="#" id="divCarreras" class="icoVista" title="Carreras">
                <i class="fa fa-graduation-cap"></i>
            </a>
            <a href="#" id="divInstituciones" class="icoVista" title="Instituciones educativas">
                <i class="fa fa-university"></i>
            </a>
        </div>
    </div>
</div>
<div class="row marginNull divTab divInformacionCarreras">
    <h3 class="tituloTabDiv">Titulos</h3>
    <table class="table tbCarreras">
        <thead>
            <tr>
                <td>Carrera</td>
                <td>Año Inicio</td>
                <td>Año Fin</td>
                <td>Observaciones</td>
                <td>Estado</td>
                <td>Acciones</td>
            </tr>
            <tr class="trAgregar">
                <td>
                    <select name="cbCarrera" class="cbCarrera cbChosenCarrera form-control">
                        @if (carreras != null && carreras.Count > 0)
                        {
                            foreach (Carrera carrera in carreras)
                            {
                                <option value="@carrera._idCarrera">@carrera._carrera</option>
                            }
                        }
                    </select>
                </td>
                <td class="tdFechaIniFinTitulo">
                    <div class="editMode hidden">
                    </div>
                    <div class="normalMode tdEmail">
                        <input name="txtYearInicio" class="txtYearInicio form-control" />
                    </div>
                </td>
                <td class="tdFechaIniFinTitulo">
                    <input name="txtYearFin" class="txtYearFin form-control" />
                </td>
                <td>
                    <textarea name="txtAreaObservaciones" class="txtAreaObservaciones form-control"></textarea>
                </td>
                <td>
                    <select name="cbEstadoCarrera" class="cbEstadoCarrera form-control">
                        @if (estadosCarrera != null && estadosCarrera.Count > 0)
                        {
                            foreach (EstadoCarrera estadoCarrera in estadosCarrera)
                            {
                                <option value="@estadoCarrera._idEstadoCarrera">@estadoCarrera._estado</option>
                            }
                        }
                    </select>
                </td>
                <td>
                    <button class="btn btnAgregarCarrera">Agregar</button>
                </td>
            </tr>
        </thead>
        <tbody class="tbodyFormacionPersonas">
            @if (formacionesPersonas != null && formacionesPersonas.Count > 0)
            {
                foreach (FormacionPersona formacionPersona in formacionesPersonas)
                {
                    <tr>
                        <td class="hidden">
                            <input name="txtHdIdFormacionPersona" class="txtHdIdFormacionPersona" value="@formacionPersona._idFormacionPersona"/>
                            <input name="txtHdIdEstadoCarrera" class="txtHdIdEstadoCarrera" value="@formacionPersona._estado._idEstadoCarrera" />
                            <input name="txtHdIdCarrera" class="txtHdIdCarrera" value="@formacionPersona._carrera._idCarrera" />
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <select name="cbCarrera" class="cbCarrera cbChosenCarrera form-control"></select>
                            </div>
                            <div class="normalMode tdCarrera">
                                @formacionPersona._carrera._carrera
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <input name="txtYearInicio" class="txtYearInicio form-control" />
                            </div>
                            <div class="normalMode tdYearInicio">
                                @formacionPersona._yearInicio
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <input name="txtYearFin" class="txtYearFin form-control" />
                            </div>
                            <div class="normalMode tdYearFin">
                                @formacionPersona._yearFin
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <textarea name="txtAreaObservaciones" class="txtAreaObservaciones form-control"></textarea>
                            </div>
                            <div class="normalMode tdObservaciones">
                                @formacionPersona._observaciones
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <select name="cbEstadoCarrera" class="cbEstadoCarrera form-control"></select>
                            </div>
                            <div class="normalMode tdEstadoTitulo">
                                @formacionPersona._estado._estado
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <button class="btn btnActualizarTituloPersona">Actualizar</button>
                                <button class="btn btnCancelarUni">Actualizar</button>
                            </div>
                            <div class="normalMode tdEmail">
                                <button class="btn btnEditarTitulos ">Editar</button>
                                <button class="btn btnEliminarTitulo ">Eliminar</button>
                            </div>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
<div class="row marginNull divTab divInstituciones hidden">
    <!-- Instituciones educativas -->
    <h3 class="tituloTabDiv">Instituciones educativas</h3>
    <div class="divResultado divResultadoGeneralInstituciones">

    </div>
    <table class="table tablaInstitucionEducativa">
       <thead>
           <tr>
               <th>Institucion educativa</th>
               <th>País</th>
               <th>Acciones</th>
           </tr>
           <tr class="trAgregar">
               <th>
                   <input name="txtInstitucionEducativa" class="form-control txtInstitucionEducativa" />
                   <div class="row marginNull divResultado hidden">
                       _
                   </div>
               </th>
               <th>
                   <select name="cbPaisInstitucionEducativa" class=" cbChosenPais form-control cbPaisInstitucionEducativa">
                       <option value="-1">Seleccione un país</option>
                       @if (paises != null && paises.Count > 0)
                       {
                           foreach (Pais pais in paises)
                           {
                               <option value="@pais._idPais">@pais._pais</option>
                           }
                       }
                   </select>
                   <div class="row marginNull divResultado hidden">
                       _
                   </div>
               </th>
               <th>
                   <button class="btn btnAgregarInstitucion">Agregar institucion</button>
               </th>
           </tr>
       </thead>
       <tbody class="tbTablaFormacionPersonas">
           @if (institucionesEducativas != null && institucionesEducativas.Count > 0 && false)
           {
               foreach (InstitucionEducativa institucion in institucionesEducativas)
               {
                   <tr>
                       <td class="hidden">
                           <input name="txtHdIdInstitucionEducativa" class="txtHdIdInstitucionEducativa" value="@institucion._idInstitucion" />
                           <input name="txtHdIdPaisInstitucion" class="txtHdIdPaisInstitucion" value="@institucion._pais._idPais"/>
                       </td>
                       <td>
                           <div class="editMode hidden">
                               <input class="txtInstitucionEducativa form-control" name="txtInstitucionEducativa" />
                           </div>
                           <div class="normalMode tdNombreInstitucion">
                               @institucion._nombre
                           </div>
                       </td>
                       <td>
                           <div class="editMode hidden">
                               <select name="cbPaisInstitucionEducativa" class=" cbChosenPais form-control cbPaisInstitucionEducativa"></select>
                           </div>
                           <div class="normalMode tdPais">
                               @institucion._pais._pais
                           </div> 
                       </td>
                       <td>
                           <div class="editMode hidden">
                                <button class="btn btnActualizarInstitucionEducativa">Actualizar</button>
                                <button class="btn btnCancelarInstitucionEducativa btnCancelarUni">Cancelar</button>
                           </div>
                           <div class="normalMode tdEmail">
                               <button class="btn btnEditarInstitucion">Editar</button>
                               <button class="btn btnEliminarInstitucion">Eliminar</button>
                           </div>
                       </td>
                   </tr>
               }
           }
           else
           {
                <tr>
                    @for(int i=0;i<3;i++){
                        <td class="hidden"></td>
                    }
                    <td colspan="4" class="text-center">
                        No hay instituciones disponibles
                    </td>
                </tr>   
           }
       </tbody>
   </table>
</div>
<div class="row marginNull divTab divCarreras hidden">
    <!-- carreras -->
    <h3 class="tituloTabDiv">Carreras</h3>
    <div class="divResultado divResultadoGeneralCarrera">

    </div>
    <table class="table tablaCarrera">
        <thead>
            <tr>
                <th>Nombre carrera</th>
                <th>Nivel carrera</th>
                <th>Institucion</th>
                <th>Area carrera</th>
                <th>Acciones</th>
            </tr>
            <tr class="trAgregar">
                <th>
                    <input name="txtNombreCarrera" class="txtNombreCarrera form-control" />
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </th>
                <th>
                    <select name="cbNivelCarrera" class="cbNivelCarrera form-control">
                        <option value="-1">Seleccione nivel de carrera</option>
                        @if (nivelesTitulo != null && nivelesTitulo.Count > 0)
                        {
                            foreach (NivelTitulo nivelTitulo in nivelesTitulo)
                            {
                                <option value="@nivelTitulo._idNivel">@nivelTitulo._nombreNivel</option>
                            }
                        }
                    </select>
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </th>
                <th>
                    <select class="cbInsticionesParaCarrera cbChosenInstitucion form-control" name="cbInsticionesParaCarrera">
                        <option value="-1">Seleccione una institucion</option>
                        @if (institucionesEducativas != null && institucionesEducativas.Count > 0)
                        {
                            string pais = ""; bool abierto = false;
                            foreach (InstitucionEducativa institucion in institucionesEducativas)
                            {
                                if (pais != institucion._pais._pais)
                                {
                                    pais = institucion._pais._pais;
                                    if (abierto == true)
                                    {
                                        new HtmlString("</optgroup>");
                                        abierto = false;
                                    }
                                    @(new HtmlString("<optgroup label='" + pais + "'>"));
                                    abierto = true;
                                }
                                <option value="@institucion._idInstitucion">@institucion._nombre</option>
                            }
                            if (abierto == true)
                            {
                                @(new HtmlString("</optgroup>"));
                            }
                        }
                    </select>
                    <div class="row marginNull divResultado hidden">
                        _
                    </div>
                </th>
                <th>
                    <select name="cbAreaCarreras" class="form-control cbAreaCarreras">
                        @if (areasCarreras != null && areasCarreras.Count > 0)
                        {
                            foreach (AreaCarrera areaCarrera in areasCarreras)
                            {
                                <option value="@areaCarrera._idArea">@areaCarrera._area</option>
                            }
                        }
                    </select>
                </th>
                <th>
                    <button class="btn btnAgregarCarreraIndividual">Agregar</button>
                </th>
            </tr>
        </thead>
        <tbody  class="tbodyCarrera">
            <!-- mostrar aqui carrera -->
            @if (carreras != null && carreras.Count > 0)
            {
                foreach (Carrera carrera in carreras)
                {
                    <tr>
                        <td class="hidden">
                            <input class="txtHdIdCarrera" name="txtHdIdCarrera" value="@carrera._idCarrera"/>
                            <input class="txtHdIdInstitucion" value="@carrera._institucion._idInstitucion"/>
                            <input class="txtHdIdNivelCarrera" value="@carrera._nivelTitulo._idNivel" />
                            <input class="txtHdIdArea" value="@carrera._area._idArea">
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <input name="txtNombreCarrera" class="txtNombreCarrera form-control" />
                            </div>
                            <div class="normalMode tdCarrera">
                                @carrera._carrera
                            </div>
                            
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <select name="cbNivelCarrera" class="cbNivelCarrera cbChosenCarrera form-control">
                                </select>
                            </div>
                            <div class="normalMode tdNivelTitulo">
                                @carrera._nivelTitulo._nombreNivel
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <select class="cbInsticionesParaCarrera cbChosenInstitucion form-control" name="cbInsticionesParaCarrera">
                                </select>
                            </div>
                            <div class="normalMode tdInstitucionNombre">
                                @carrera._institucion._nombre
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <select name="cbAreaCarreras" class="form-control cbAreaCarreras"></select>
                            </div>
                            <div class="normalMode tdAreaCarrera">
                                @carrera._area._area
                            </div>
                        </td>
                        <td>
                            <div class="editMode hidden">
                                <button class="btn btnActualizarCarrera">Actualizar</button>
                                <button class="btn btnCancelarUni">Cancelar</button>
                            </div>
                            <div class="normalMode tdEmail">
                                <button class="btnEditarCarrera btn">Editar</button>
                                <button class="btn btnEliminarCarrera">Eliminar</button>
                            </div>
                            <!--<button class="btn">Cancelar</button>-->
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
